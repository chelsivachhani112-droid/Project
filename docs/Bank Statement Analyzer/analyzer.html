<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Analyzer | Finova</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        .chart-container { position: relative; height: 320px; width: 100%; }
        canvas { filter: drop-shadow(0px 4px 6px rgba(0,0,0,0.05)); }
    </style>
</head>
<body class="bg-[#f1f5f9] text-[#1e293b] pb-20">

    <nav class="bg-white border-b-2 border-slate-200 sticky top-0 z-50 px-6 h-16 flex justify-between items-center shadow-md">
        <div class="flex items-center gap-2 font-black text-2xl text-blue-700">
            <i data-lucide="shield-check" class="fill-blue-100"></i> FINOVA
        </div>
        <div class="flex gap-8 text-sm font-bold text-slate-700">
            <a href="analyzer.html" class="text-blue-700 border-b-4 border-blue-700 pb-4 mt-4">Analyzer</a>
            <a href="goals.html" class="hover:text-blue-700 transition">Goals</a>
            <a href="education.html" class="hover:text-blue-700 transition">Education</a>
        </div>
    </nav>

    <main id="reportContent" class="max-w-6xl mx-auto p-6">
        <header class="flex flex-col md:row justify-between items-start mb-10 gap-4">
            <div>
                <h1 class="text-4xl font-black text-slate-900 tracking-tight">Financial Analyzer</h1>
                <p class="text-slate-600 font-medium">Clear insights from your bank statements.</p>
            </div>
            <button id="downloadBtn" onclick="generatePDF()" class="hidden bg-slate-900 text-white px-6 py-3 rounded-xl font-bold flex items-center gap-2 hover:bg-black transition-all shadow-xl active:scale-95">
                <i data-lucide="file-down"></i> Export Report (PDF)
            </button>
        </header>

        <div id="summaryCards" class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10 hidden">
            <div class="bg-white p-6 rounded-2xl border-l-8 border-red-500 shadow-sm">
                <p class="text-slate-500 text-xs font-bold uppercase">Total Expenses</p>
                <h2 id="totalExp" class="text-3xl font-black text-slate-900 mt-1">$0</h2>
            </div>
            <div class="bg-white p-6 rounded-2xl border-l-8 border-blue-600 shadow-sm">
                <p class="text-slate-500 text-xs font-bold uppercase">Top Category</p>
                <h2 id="topCat" class="text-2xl font-black text-slate-900 mt-1">-</h2>
            </div>
            <div class="bg-white p-6 rounded-2xl border-l-8 border-emerald-500 shadow-sm">
                <p class="text-slate-500 text-xs font-bold uppercase">Avg. Daily</p>
                <h2 id="avgSpend" class="text-3xl font-black text-slate-900 mt-1">$0</h2>
            </div>
            <div class="bg-white p-6 rounded-2xl border-l-8 border-purple-500 shadow-sm">
                <p class="text-slate-500 text-xs font-bold uppercase">Transactions</p>
                <h2 id="transCount" class="text-3xl font-black text-slate-900 mt-1">0</h2>
            </div>
        </div>

        <div id="uploadSection" class="bg-white border-4 border-dashed border-slate-300 rounded-3xl p-16 text-center mb-10 transition-all hover:border-blue-600 hover:bg-blue-50 group">
            <input type="file" id="fileInput" class="hidden" accept=".csv">
            <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:bg-blue-600 transition-colors">
                <i data-lucide="cloud-upload" class="text-blue-600 w-10 h-10 group-hover:text-white transition-colors"></i>
            </div>
            <h3 class="text-2xl font-black text-slate-900 mb-2">Drop Statement Here</h3>
            <p class="text-slate-500 font-medium mb-8">CSV must contain: <b>Date, Category, Amount</b></p>
            <button onclick="document.getElementById('fileInput').click()" class="bg-blue-600 text-white px-10 py-4 rounded-2xl font-black text-lg shadow-lg hover:bg-blue-700 transition-all">Select CSV File</button>
        </div>

        <div id="mainDisplay" class="grid grid-cols-1 lg:grid-cols-2 gap-8 hidden">
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200">
                <h3 class="font-black text-xl mb-6 flex items-center gap-2">
                    <i data-lucide="pie-chart" class="text-blue-600"></i> Spending Split
                </h3>
                <div class="chart-container">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200">
                <h3 class="font-black text-xl mb-6 flex items-center gap-2">
                    <i data-lucide="trending-up" class="text-emerald-600"></i> Cash Flow Trend
                </h3>
                <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
        </div>
    </main>

    <script>
        lucide.createIcons();
        let catChart, trnChart;

        // Configuration for High Contrast
        const chartColors = ['#1e3a8a', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4'];

        function initCharts(catLabels, catData, trendLabels, trendData) {
            const ctx1 = document.getElementById('categoryChart').getContext('2d');
            const ctx2 = document.getElementById('trendChart').getContext('2d');

            if (catChart) catChart.destroy();
            if (trnChart) trnChart.destroy();

            catChart = new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: catLabels,
                    datasets: [{
                        data: catData,
                        backgroundColor: chartColors,
                        borderWidth: 4,
                        hoverOffset: 20
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { position: 'bottom', labels: { font: { weight: 'bold', size: 12 }, padding: 20 } }
                    }
                }
            });

            trnChart = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: trendLabels,
                    datasets: [{
                        label: 'Daily Spending',
                        data: trendData,
                        borderColor: '#059669',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 4,
                        pointRadius: 6,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#059669'
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        y: { ticks: { font: { weight: 'bold' } }, grid: { display: false } },
                        x: { ticks: { font: { weight: 'bold' } }, grid: { display: false } }
                    }
                }
            });
        }

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                const rows = event.target.result.split('\n').slice(1).map(r => r.split(','));
                const catMap = {}, dateMap = {};
                let total = 0;

                rows.forEach(row => {
                    if (row.length >= 3) {
                        const date = row[0].trim();
                        const cat = row[1].trim();
                        const amt = parseFloat(row[2].replace(/[^0-9.-]+/g,""));
                        if (!isNaN(amt)) {
                            catMap[cat] = (catMap[cat] || 0) + amt;
                            dateMap[date] = (dateMap[date] || 0) + amt;
                            total += amt;
                        }
                    }
                });

                // Update UI
                document.getElementById('mainDisplay').classList.remove('hidden');
                document.getElementById('summaryCards').classList.remove('hidden');
                document.getElementById('downloadBtn').classList.remove('hidden');
                document.getElementById('totalExp').innerText = `$${total.toLocaleString()}`;
                const top = Object.keys(catMap).reduce((a, b) => catMap[a] > catMap[b] ? a : b);
                document.getElementById('topCat').innerText = top;
                document.getElementById('avgSpend').innerText = `$${(total / Object.keys(dateMap).length).toFixed(0)}`;
                document.getElementById('transCount').innerText = rows.length;

                initCharts(Object.keys(catMap), Object.values(catMap), Object.keys(dateMap), Object.values(dateMap));
            };
            reader.readAsText(file);
        });

        async function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            const element = document.getElementById('reportContent');
            document.getElementById('uploadSection').style.display = 'none';
            
            await html2canvas(element).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdfWidth = doc.internal.pageSize.getWidth();
                const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
                doc.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                doc.save('Finova_Report.pdf');
            });
            document.getElementById('uploadSection').style.display = 'block';
        }
    </script>
</body>
</html>